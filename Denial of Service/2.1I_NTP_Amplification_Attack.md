# NTP Amplification Attack

## üìç Attack Classification
- **Category**: Volumetric Attack (Amplification + Reflection)
- **OSI Layer**: Layer 4 (Transport) / Layer 7 (Application)
- **Protocol**: NTP (Network Time Protocol) over UDP
- **Port**: UDP 123

## üéØ Attack Mechanism
Exploits **NTP's monlist command** to amplify small requests into large responses, using **IP spoofing** to reflect massive traffic to victim.

### How it Works:
1. **IP Spoofing**: Attacker spoofs victim's IP address
2. **NTP Request**: Send small monlist query to NTP servers
3. **Large Response**: NTP servers reply with up to 600x larger data
4. **Traffic Reflection**: Massive responses sent to victim

## üîç Key Characteristics
- **Massive Amplification**: Up to 206:1 amplification ratio
- **UDP Protocol**: Connectionless, easy to spoof
- **Monlist Command**: Returns list of recent NTP clients
- **Public Servers**: Uses open NTP servers as amplifiers

## üö® Exam Focus Points

### Critical Numbers:
- **Request Size**: ~8 bytes (monlist query)
- **Response Size**: Up to 1,650+ bytes (client list)
- **Amplification Factor**: 206:1 ratio
- **Default Port**: UDP 123

### Common Exam Questions:
- **Q**: What NTP command is exploited in amplification attacks?
- **A**: monlist command (or "readvar" in newer versions)
- **Q**: What is the typical amplification ratio for NTP attacks?
- **A**: Up to 206:1 (small request ‚Üí large response)
- **Q**: Why is UDP important in NTP amplification?
- **A**: UDP allows easy IP spoofing without connection state

### Attack Components:
- **Victim**: Target receiving amplified responses
- **Amplifier**: Open NTP servers responding to queries
- **Attacker**: Sends spoofed NTP requests
- **Monlist**: NTP command returning client history

## ‚ö° Attack Variations
- **Multi-amplifier**: Using thousands of NTP servers
- **Distributed**: Multiple attackers coordinating
- **Mixed Protocol**: Combining with DNS/SNMP amplification
- **Fragmented**: Large responses cause fragmentation overhead

## üõ°Ô∏è Detection & Mitigation
- **Server-side Protection**:
  - Disable monlist command
  - Rate limiting per source IP
  - Access control lists (ACLs)
  - Update to NTP v4.2.7+

- **Network Protection**:
  - Ingress filtering (BCP 38)
  - Monitor outbound NTP traffic
  - Block amplification traffic patterns

### NTP Server Hardening:
```
# ntp.conf settings
restrict default kod nomodify notrap nopeer noquery
restrict -6 default kod nomodify notrap nopeer noquery
disable monitor  # Disables monlist
```

## üîß Attack Tools & Commands
- **ntpdc**: `ntpdc -c monlist ntp_server`
- **Custom Scripts**: Automated spoofing tools
- **Metasploit**: `auxiliary/scanner/ntp/ntp_monlist`
- **nmap**: `nmap -sU -p 123 --script ntp-monlist`

### Manual Testing:
```bash
# Check if NTP server supports monlist
echo -e "\x17\x00\x03\x2a" | nc -u ntp_server 123

# Using ntpdc
ntpdc -c monlist target_ntp_server
```

## üí° Historical Context
- **2013-2014**: Major NTP amplification campaigns
- **Spamhaus Attack**: 300+ Gbps using NTP amplification
- **GitHub Attack**: 1.35 Tbps (combination of attacks)
- **Industry Response**: Widespread NTP server hardening

## üìä Amplification Comparison
| Protocol | Amplification Factor | Port |
|----------|---------------------|------|
| NTP | 206.9:1 | 123/udp |
| DNS | 28-54:1 | 53/udp |
| SNMP | 6.3:1 | 161/udp |
| SSDP | 30.8:1 | 1900/udp |
| Memcached | 10,000+:1 | 11211/udp |

## üéØ Target Selection
Attackers look for:
- **Open NTP servers** (no access restrictions)
- **High bandwidth** servers for maximum impact
- **Geographically distributed** servers
- **Vulnerable versions** (pre-4.2.7)

## ‚ö†Ô∏è Vulnerable NTP Versions
- **NTP < 4.2.7**: monlist enabled by default
- **ntpd**: Most common NTP daemon
- **Legacy systems**: Often unpatched NTP servers
- **IoT devices**: Embedded NTP implementations

## üîç Detection Indicators
- **Outbound NTP traffic spikes**
- **UDP 123 traffic anomalies**
- **Large packet sizes from NTP servers**
- **Multiple NTP servers responding simultaneously**

## üåê Internet Impact
- **Scanning Studies**: Millions of vulnerable NTP servers
- **Cleanup Efforts**: ISPs blocking vulnerable servers
- **Best Practices**: NTP security guidelines
- **Monitoring**: Continuous assessment of open amplifiers

## üí° Defense Strategy
1. **Prevent Being Amplifier**: Secure your NTP servers
2. **Prevent Being Victim**: Implement ingress filtering
3. **Monitor Traffic**: Watch for amplification patterns
4. **Incident Response**: Rapid mitigation procedures

## üîß Verification Commands
```bash
# Check if monlist is disabled
ntpq -c "rv 0 version"

# Test monlist vulnerability
ntpdc -c monlist target_server

# Check NTP version
ntpq -c version target_server
```
