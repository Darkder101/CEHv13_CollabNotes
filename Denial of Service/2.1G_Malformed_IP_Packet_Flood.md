# Malformed IP Packet Flood

## Attack Classification
- **Category**: Volumetric Attack (Complexity-based)
- **OSI Layer**: Layer 3 (Network)
- **Protocol**: IP (Internet Protocol)
- **Target**: Packet processing systems

## Attack Mechanism
Floods target with **malformed or invalid IP packets** that require additional processing cycles to parse, validate, and discard, overwhelming system resources.

### How it Works:
1. **Packet Crafting**: Create IP packets with invalid headers/fields
2. **Processing Overhead**: Target systems spend CPU cycles validating packets
3. **Resource Exhaustion**: Parsing malformed packets consumes more resources
4. **Service Degradation**: Legitimate traffic processing slowed/blocked

## Key Characteristics
- **Invalid Headers**: Corrupted or impossible IP header values
- **Processing Intensive**: More CPU required than normal packets
- **Parsing Confusion**: May cause errors in network stack
- **Firewall Bypass**: Some malformed packets bypass simple filters

## Exam Focus Points

### Common Malformation Types:
- **Invalid Header Length**: IHL field set incorrectly
- **Bad Checksums**: Intentionally wrong IP checksum values
- **Invalid Flags**: Illegal combination of IP flags
- **Wrong Versions**: Non-IPv4/IPv6 version numbers
- **Oversized Options**: IP options longer than allowed
- **Invalid TTL**: Time-To-Live set to impossible values

### Common Exam Questions:
- **Q**: Why are malformed IP packets effective in DoS attacks?
- **A**: They require more CPU cycles to process and validate
- **Q**: What part of the system handles malformed IP packets?
- **A**: Network stack's packet parsing and validation routines
- **Q**: How do malformed packets differ from normal flood attacks?
- **A**: They exploit processing complexity rather than just volume

### IP Header Fields Often Targeted:
- **Version**: Should be 4 (IPv4) or 6 (IPv6)
- **IHL**: Internet Header Length (5-15)
- **Total Length**: Must match actual packet size
- **Fragment Offset**: Used with fragmentation flags
- **Protocol**: Must correspond to valid upper layer protocol

## Attack Variations
- **Teardrop Attack**: Overlapping fragment offsets
- **Land Attack**: Source and destination IPs identical
- **Winnuke**: Invalid TCP flags with malformed IP
- **Fragment Overflow**: Fragment offset causing buffer overflow

## Detection & Mitigation
- **Deep Packet Inspection**: Validate all IP header fields
- **Packet Sanitization**: Drop malformed packets early
- **Rate Limiting**: Limit packets requiring complex validation
- **Hardware Filtering**: Use ASICs for high-speed validation

### Validation Checks:
```
- Version field = 4 (IPv4)
- Header length ≥ 20 bytes
- Total length ≥ header length
- Valid checksum calculation
- Proper flag combinations
- Reasonable TTL values
```

## Attack Tools & Techniques
- **Scapy**: Python packet crafting library
- **hping3**: Command-line packet generator
- **Nemesis**: Packet injection tool
- **Custom Scripts**: Programmatic packet malformation

### Example Scapy Code:
```python
# Create malformed IP packet
malformed_pkt = IP(version=3, ihl=0, len=0)/Raw("data")
send(malformed_pkt, count=1000)
```

## Why Effective?
- **Processing Overhead**: Validation requires CPU cycles
- **Exception Handling**: Error processing consumes resources
- **Stack Confusion**: May cause network stack instability
- **Logging Overhead**: Systems log malformed packet events

## Impact Analysis
| Packet Type | Processing Cost | Impact |
|-------------|----------------|---------|
| Valid Packet | Low | Normal forwarding |
| Malformed Packet | High | CPU-intensive validation |
| Crafted Attack | Very High | Error handling + logging |

## Target Systems
- **Firewalls**: Deep packet inspection systems
- **Routers**: Packet forwarding engines
- **Intrusion Detection**: Signature matching systems
- **Load Balancers**: Traffic distribution systems

## Modern Defenses
- **Hardware Acceleration**: ASIC-based packet validation
- **Early Filtering**: Drop malformed packets at network edge
- **Rate Limiting**: Limit malformed packet processing
- **Anomaly Detection**: Identify unusual packet patterns

## Forensic Analysis
- **Packet Captures**: Analyze malformed packet characteristics
- **System Logs**: Review error messages and exceptions
- **Performance Metrics**: Monitor CPU usage during attacks
- **Network Monitoring**: Track malformed packet rates
