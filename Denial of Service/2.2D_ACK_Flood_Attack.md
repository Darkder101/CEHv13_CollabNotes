# ACK Flood Attack

## üìç Attack Classification
- **Category**: Volumetric Attack / Stateful Firewall Bypass
- **OSI Layer**: Layer 4 (Transport)
- **Protocol**: TCP
- **Port**: Any TCP port (commonly 80, 443, 22, 25)

## üéØ Attack Mechanism
Exploits **TCP ACK packets** to bypass stateful firewalls and overwhelm target systems by sending massive volumes of **unsolicited ACK packets** that appear to be part of established connections.

### How it Works:
1. **ACK Generation**: Send high-volume ACK packets
2. **Firewall Bypass**: ACKs often pass through stateful filters
3. **Resource Consumption**: Server processes unexpected ACKs
4. **State Confusion**: Overwhelm connection tracking

## üîç Key Characteristics
- **Stateful Bypass**: ACKs suggest established connections
- **Low Detection**: Appears like legitimate traffic
- **Resource Intensive**: Server must process each ACK
- **Spoofed Sources**: Difficult to trace back

## üö® Exam Focus Points

### Critical Numbers:
- **TCP Window Size**: 0-65,535 (often randomized)
- **Sequence Numbers**: Random/sequential values
- **Typical Rate**: 10,000-100,000+ ACK/sec
- **Packet Size**: 40-60 bytes per ACK

### Common Exam Questions:
- **Q**: Why do ACK floods often bypass firewalls?
- **A**: Stateful firewalls assume ACKs belong to established connections
- **Q**: What TCP flag is set in ACK flood attacks?
- **A**: ACK flag only (no SYN, FIN, RST)
- **Q**: How does server respond to unexpected ACKs?
- **A**: Sends RST packets, consuming resources

### Attack Components:
- **ACK Packets**: TCP segments with ACK flag set
- **Random Sequence**: Non-sequential sequence numbers
- **Spoofed Sources**: Randomized IP addresses
- **High Volume**: Sustained packet rates

## ‚ö° Attack Variations

### Pure ACK Flood:
- **Method**: Only ACK flag set
- **Impact**: Firewall bypass, resource exhaustion
- **Detection**: Moderate difficulty

### ACK-PSH Flood:
- **Method**: ACK + PUSH flags combined
- **Impact**: Higher processing overhead
- **Stealth**: Appears more legitimate

### Fragmented ACK Flood:
- **Method**: Fragmented ACK packets
- **Impact**: Reassembly resource consumption
- **Complexity**: Higher processing cost

### Distributed ACK Flood:
- **Method**: Multiple sources simultaneously
- **Impact**: Massive scale attacks
- **Mitigation**: More difficult to block

## üõ°Ô∏è Detection & Mitigation
- **Network Protection**:
  - Stateful connection tracking
  - ACK rate limiting per IP
  - Sequence number validation
  - Connection state verification

- **Firewall Rules**:
  - Block unsolicited ACKs
  - Implement strict stateful inspection
  - Rate limiting rules
  - Anomaly detection

### System Hardening:
```bash
# iptables ACK flood protection
iptables -A INPUT -p tcp --tcp-flags ACK ACK -m state --state NEW -j DROP
iptables -A INPUT -p tcp --tcp-flags ACK ACK -m limit --limit 10/sec -j ACCEPT

# TCP settings
echo 1 > /proc/sys/net/ipv4/tcp_rfc1337
echo 0 > /proc/sys/net/ipv4/tcp_timestamps
```

## üîß Attack Tools & Commands
- **hping3**: `hping3 -A -p 80 --flood target`
- **Scapy**: Custom ACK flood scripts
- **Nping**: `nping --tcp -p 80 --flags A target`
- **Packeth**: GUI packet crafting

### Manual Testing:
```bash
# Basic ACK flood
hping3 -A -p 80 --flood -V target_ip

# Randomized ACK flood
hping3 -A -p 80 --rand-source --flood target_ip

# Multiple port ACK flood
for port in {80,443,22,25}; do
  hping3 -A -p $port --flood target_ip &
done
```

## üí° Historical Context
- **Early 2000s**: ACK floods discovered as firewall bypass
- **Stateful Firewall Era**: Exploited connection state assumptions
- **Modern Networks**: Still effective against poorly configured systems
- **DDoS Evolution**: Part of multi-vector attacks

## üìä TCP Flag Attack Comparison
| Attack Type | Flags | Bypass Capability | Detection |
|-------------|-------|-------------------|-----------|
| SYN Flood | SYN | Low | Easy |
| ACK Flood | ACK | High | Moderate |
| FIN Flood | FIN | Medium | Easy |
| RST Flood | RST | High | Moderate |

## üéØ Target Selection
Preferred targets:
- **Web servers** behind stateful firewalls
- **Application servers** with connection tracking
- **Load balancers** with state tables
- **VPN gateways** with connection monitoring

## ‚ö†Ô∏è Vulnerable Configurations
- **Permissive firewalls**: Allow all ACK packets
- **Weak state tracking**: Poor connection validation
- **High timeouts**: Long connection state retention
- **No rate limiting**: Unlimited ACK processing

## üîç Detection Indicators
- **High ACK packet rates**
- **Unsolicited ACK patterns**
- **Increased RST responses**
- **Firewall connection table growth**

### Detection Commands:
```bash
# Monitor ACK packets
tcpdump -n 'tcp[tcpflags] == tcp-ack'

# Check connection states
netstat -an | grep -E "(ESTABLISHED|TIME_WAIT)" | wc -l

# Monitor RST responses
tcpdump -n 'tcp[tcpflags] == tcp-rst' | wc -l

# Firewall state table monitoring
cat /proc/net/nf_conntrack | wc -l
```

## üåê Network Impact
- **Bandwidth Consumption**: Moderate to high
- **Connection Table Pollution**: State tracking overhead
- **Firewall Performance**: Processing overhead increase
- **Legitimate Traffic**: May be impacted by responses

## üí° Defense Strategy
1. **Strict Stateful Inspection**: Validate connection context
2. **Rate Limiting**: Limit ACK packets per source
3. **Sequence Validation**: Check sequence number validity
4. **Connection Tracking**: Maintain accurate state tables
5. **Anomaly Detection**: Identify unusual ACK patterns

## üîß Verification Commands
```bash
# Test ACK handling
hping3 -A -p 80 -c 1 target_ip

# Check if unsolicited ACKs are blocked
nmap -sA -p 80 target_ip

# Monitor connection tracking
watch 'cat /proc/net/nf_conntrack | grep ESTABLISHED | wc -l'

# Firewall rule effectiveness
iptables -L -n -v | grep -i ack
```

## üìà Attack Metrics
- **Packet Rate**: 5,000-50,000 ACK/sec
- **Response Rate**: High RST generation
- **Resource Impact**: CPU-intensive processing
- **Duration**: Can be sustained for hours

## üîÑ Advanced Evasion
- **Sequence Prediction**: Use predictable sequences
- **Window Scaling**: Manipulate TCP window
- **Timestamp Options**: Add TCP timestamps
- **Mixed Protocols**: Combine with other floods
- **Legitimate Mimicking**: Copy real connection patterns
